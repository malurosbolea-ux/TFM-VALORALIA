<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Valoralia | Dashboard Técnico TFM</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #121212; color: #e0e0e0; font-family: 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 0; overflow: hidden; }
        .dashboard-container { display: flex; height: 100vh; }
        
        /* SIDEBAR */
        .sidebar { width: 260px; background-color: #1e1e1e; padding: 25px; border-right: 1px solid #333; display: flex; flex-direction: column; }
        .logo { color: #00d084; font-weight: 800; font-size: 1.6rem; margin-bottom: 40px; text-transform: uppercase; letter-spacing: 2px; display:flex; align-items:center; gap:10px;}
        .menu-item { padding: 12px 15px; margin-bottom: 8px; border-radius: 6px; cursor: pointer; color: #aaa; transition: all 0.3s; font-size: 0.95rem; display: flex; align-items: center; gap: 10px; }
        .menu-item:hover { background-color: #2c2c2c; color: white; }
        .menu-item.active { background-color: #2c2c2c; color: white; border-left: 4px solid #00d084; }
        
        /* MAIN CONTENT */
        .main-content { flex: 1; padding: 30px; overflow-y: auto; position: relative; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .status-badge { background-color: rgba(0, 208, 132, 0.15); color: #00d084; padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: bold; border: 1px solid #00d084; display:flex; align-items:center; gap:5px; }
        
        /* SECCIONES (Pestañas) */
        .section { display: none; animation: fadeIn 0.3s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* KPI CARDS */
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .kpi-card { background-color: #1e1e1e; padding: 20px; border-radius: 12px; border: 1px solid #333; transition: transform 0.2s; }
        .kpi-card:hover { transform: translateY(-5px); border-color: #00d084; }
        .kpi-title { font-size: 0.9rem; color: #888; margin-bottom: 10px; }
        .kpi-value { font-size: 2rem; font-weight: bold; color: white; }
        .kpi-trend { font-size: 0.85rem; margin-top: 5px; display:flex; align-items:center; gap:5px; }
        .trend-up { color: #00d084; } .trend-down { color: #ff6b6b; }
        
        /* CHARTS */
        .charts-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px; }
        .chart-card { background-color: #1e1e1e; padding: 25px; border-radius: 12px; border: 1px solid #333; height: 350px; }
        
        /* BOTONES INTERACTIVOS */
        .action-btn { background: #00d084; color: black; border: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; cursor: pointer; margin-top: 20px; }
        .action-btn:hover { background: #00a066; }
        input { background: #333; border: 1px solid #444; color: white; padding: 10px; border-radius: 5px; width: 100%; margin-top: 10px; }
    </style>
</head>
<body>

<div class="dashboard-container">
    <div class="sidebar">
        <div class="logo"><i class="fas fa-cube"></i> Valoralia</div>
        <div class="menu-item active" onclick="showSection('monitor')"><i class="fas fa-chart-line"></i> Monitorización</div>
        <div class="menu-item" onclick="showSection('training')"><i class="fas fa-brain"></i> Entrenamiento</div>
        <div class="menu-item" onclick="showSection('drift')"><i class="fas fa-exclamation-triangle"></i> Detección Drift</div>
        <div class="menu-item" onclick="showSection('api')"><i class="fas fa-code"></i> API Config</div>
    </div>

    <div class="main-content">
        <div class="header">
            <div>
                <h1 style="margin:0; font-size:1.8rem;">Panel de Control Técnico</h1>
                <p style="color:#666; margin:5px 0 0;">AWS EC2 Instance: i-0cc6722500c71bcf2 | Zona: eu-north-1</p>
            </div>
            <div class="status-badge"><span style="font-size:1.2rem">●</span> ONLINE</div>
        </div>

        <div id="monitor" class="section active">
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-title">Tasaciones Hoy</div>
                    <div class="kpi-value">124</div>
                    <div class="kpi-trend trend-up"><i class="fas fa-arrow-up"></i> +12% vs ayer</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-title">MAE (Error Medio)</div>
                    <div class="kpi-value">32.947 €</div>
                    <div class="kpi-trend trend-up" style="color:#aaa"><i class="fas fa-check"></i> Validado TFM</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-title">Precisión (R²)</div>
                    <div class="kpi-value">89.4%</div>
                    <div class="kpi-trend trend-up"><i class="fas fa-minus"></i> Estable</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-title">Latencia</div>
                    <div class="kpi-value">120ms</div>
                    <div class="kpi-trend trend-up"><i class="fas fa-bolt"></i> Óptimo</div>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-card">
                    <h3><i class="fas fa-chart-area"></i> Monitor de Precisión</h3>
                    <canvas id="chartDrift"></canvas>
                </div>
                <div class="chart-card">
                    <h3><i class="fas fa-map-marker-alt"></i> Error por Zona</h3>
                    <canvas id="chartGeo"></canvas>
                </div>
            </div>
        </div>

        <div id="training" class="section">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                <div class="chart-card" style="height: auto;">
                    <h3><i class="fas fa-terminal"></i> Logs de Entrenamiento</h3>
                    <div style="background:#222; padding:15px; border-radius:5px; font-family:monospace; margin:15px 0; font-size:0.9rem; color:#00d084;">
                        > Initializing Random Forest (n=60)...<br>
                        > Loading dataset (20.000 records)... OK<br>
                        > Splitting Train/Test (80/20)... OK<br>
                        > Applying Anti-Hallucination Constraints... OK<br>
                        > Training Epochs... [================] 100%<br>
                        > Final Validation Score: 0.894<br>
                        > Model saved as: Valoralia_RF_v2.pkl
                    </div>
                    <button class="action-btn" onclick="alert('Iniciando re-entrenamiento en background...')">RE-ENTRENAR MODELO</button>
                </div>

                <div class="chart-card" style="height: 350px;">
                    <h3><i class="fas fa-bezier-curve"></i> Curva de Convergencia</h3>
                    <p style="color:#aaa; font-size:0.8rem;">Reducción del error (Loss) durante el entrenamiento.</p>
                    <canvas id="chartTrainLoss"></canvas>
                </div>
            </div>
        </div>

        <div id="drift" class="section">
             <div class="chart-card" style="height: auto;">
                <h3><i class="fas fa-search-dollar"></i> Análisis de Concept Drift (Crisis)</h3>
                <p style="color:#aaa">Simulación de impacto ante un escenario de "Crash Financiero" (-20% valor mercado).</p>
                <br>
                <div style="display:flex; justify-content:space-around; margin-bottom:30px; text-align:center;">
                    <div>
                        <span style="color:#888">Error Actual (Estabilidad)</span><br>
                        <span style="font-size:2rem; color:#00d084; font-weight:bold;">4.2%</span>
                    </div>
                    <div>
                        <span style="color:#888">Error Simulado (Crisis)</span><br>
                        <span style="font-size:2rem; color:#ff6b6b; font-weight:bold;">18.5%</span>
                    </div>
                </div>
                <div style="background:rgba(255, 107, 107, 0.15); border:1px solid #ff6b6b; padding:20px; border-radius:8px; display:flex; align-items:center; gap:15px;">
                    <i class="fas fa-exclamation-triangle" style="font-size:2rem; color:#ff6b6b;"></i>
                    <div>
                        <strong style="color:#ff6b6b; font-size:1.1rem;">ALERTA CRÍTICA DE DRIFT</strong>
                        <p style="margin:5px 0 0; color:#ddd;">El modelo ha detectado una degradación severa en la precisión debido a cambios estructurales en el mercado (Simulación). Se recomienda recalibrar pesos.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="api" class="section">
            <div class="chart-card" style="height: auto;">
                <h3><i class="fas fa-key"></i> Credenciales API (Desarrollador)</h3>
                <label style="color:#aaa">Endpoint de Producción</label>
                <input type="text" value="http://13.62.247.160/predict" readonly>
                <br><br>
                <label style="color:#aaa">API Key (Oculta)</label>
                <input type="password" value="sk_live_valoralia_8923892389" readonly>
                <button class="action-btn" style="background:#3b82f6;">GENERAR NUEVA KEY</button>
            </div>
        </div>

    </div>
</div>

<script>
    // LÓGICA DE PESTAÑAS
    function showSection(id) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // CONFIG GRÁFICOS
    Chart.defaults.color = '#888';
    Chart.defaults.borderColor = '#333';

    // 1. Gráfico Monitorización (Drift)
    new Chart(document.getElementById('chartDrift'), {
        type: 'line',
        data: {
            labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May (Crisis)'],
            datasets: [{
                label: 'Precisión (R²)',
                data: [0.89, 0.89, 0.88, 0.89, 0.65],
                borderColor: '#00d084',
                backgroundColor: 'rgba(0, 208, 132, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                segment: {
                    borderColor: ctx => ctx.p0.parsed.x >= 3 ? '#ff6b6b' : '#00d084',
                    borderDash: ctx => ctx.p0.parsed.x >= 3 ? [5, 5] : undefined
                }
            }]
        },
        options: { responsive: true, maintainAspectRatio: false, plugins: { tooltip: { enabled: true } } }
    });

    // 2. Gráfico Zonas
    new Chart(document.getElementById('chartGeo'), {
        type: 'doughnut',
        data: {
            labels: ['Salamanca', 'Centro', 'Usera', 'Periferia'],
            datasets: [{
                data: [15, 25, 40, 20],
                backgroundColor: ['#00d084', '#3b82f6', '#f1c40f', '#ff6b6b'],
                borderWidth: 0
            }]
        },
        options: { responsive: true, maintainAspectRatio: false, cutout: '70%' }
    });

    // 3. Gráfico ENTRENAMIENTO (NUEVO) - Curva de Aprendizaje
    new Chart(document.getElementById('chartTrainLoss'), {
        type: 'line',
        data: {
            labels: ['Iter 10', 'Iter 20', 'Iter 30', 'Iter 40', 'Iter 50', 'Iter 60'],
            datasets: [{
                label: 'Error de Entrenamiento (Loss)',
                data: [45000, 38000, 34000, 33000, 32950, 32947],
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                borderWidth: 2,
                fill: true,
                pointRadius: 4
            }]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });
</script>
</body>
</html>